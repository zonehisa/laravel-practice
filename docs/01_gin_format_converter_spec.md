# 全銀フォーマット自動変換システム 要件定義書

## 1. プロジェクト概要
本システムは、地場産業振興センターの事務スタッフが行う振込業務において、Excelで管理されている顧客情報を、銀行の一括振込用データ形式「全銀フォーマット（総合振込レコードフォーマット）」へ自動変換することを目的とする。

- **現状の課題 (As-Is):**
  - Excelの顧客情報を元に、全銀フォーマットのテキストデータを1件ずつ手作業で作成しており、時間がかかる。
  - 手作業による入力ミスが発生するリスクがあり、振込エラーの原因となる可能性がある。
- **導入後の理想 (To-Be):**
  - Excelファイルをアップロードするだけで、全銀協規定の総合振込レコードフォーマットに準拠したテキストファイルが即座に生成される。
  - 振込データ作成時間が大幅に短縮され、業務効率が向上する。
  - 手作業を排除することで入力ミスがなくなり、振込業務の正確性が担保される。
- **対象ユーザー:** 地場産業振興センターの事務スタッフ

## 2. ユーザーストーリー
「事務スタッフとして、【エクセルの顧客情報を全銀フォーマット（総合振込レコードフォーマット）に変換したい】ので、【ボタン一つで総合振込レコードフォーマットに対応したファイルを作成し、ダウンロードできるようにしてほしい】」

## 3. 機能要件

| 優先度 | 機能分類 | 機能概要 |
| :--- | :--- | :--- |
| **Must** | Excelアップロード | 振込先情報が記載された指定フォーマットのExcelファイルをアップロードする機能。 |
| **Must** | 総合振込レコードフォーマット変換 | アップロードされたデータを、全銀協規定の総合振込レコードフォーマット（固定長120バイト）に自動で変換する機能。 |
| **Must** | ファイルダウンロード | 変換後の総合振込レコードフォーマットファイル（.txt）をダウンロードする機能。 |
| Could | 変換履歴保存 | 変換日時、元ファイル名などの履歴を保存・管理する機能。（※DBが必要） |
| Could | 過去分ダウンロード | 履歴画面から過去に変換した総合振込レコードフォーマットファイルを再ダウンロードできる機能。（※DBが必要） |

## 4. データ要件（Excelから読み込む情報）
システムが変換処理のインプットとして必要とするデータ項目は以下の通り。

- 受取人名（カナ）
- 振込先銀行名、銀行コード
- 振込先支店名、支店コード
- 預金種別（普通、当座など）
- 口座番号
- 振込金額

## 5. 総合振込レコードフォーマット仕様

### 5.1 レコード構成
総合振込レコードフォーマットは、以下の4種類のレコードで構成されます（各レコードは120バイト固定長）：

1. **ヘッダ・レコード**：ファイルの先頭に位置し、データの概要を示します。
2. **データ・レコード**：各振込情報を含むレコードで、振込件数分存在します。
3. **トレーラ・レコード**：データ・レコードの後に位置し、データの総計などを示します。
4. **エンド・レコード**：ファイルの末尾に位置し、ファイルの終了を示します。

### 5.2 レコード詳細

#### ヘッダ・レコード（120バイト）
- レコード区分（1バイト）：1
- データ種別（2バイト）：21（総合振込）
- コード区分（1バイト）：0（全銀協コード）
- 委託者コード（10バイト）
- 委託者名（40バイト）
- 振込指定日（4バイト）：MMDD形式（月日）
- 振込元銀行番号（4バイト）
- 振込元支店番号（3バイト）
- 予備（55バイト）

#### データ・レコード（120バイト）
- レコード区分（1バイト）：2
- 振込先銀行番号（4バイト）
- 振込先支店番号（3バイト）
- 預金種目（1バイト）：1=普通、2=当座、4=納税準備預金
- 口座番号（7バイト）
- 受取人名（30バイト）：半角カナ
- 振込金額（10バイト）
- 新規コード（1バイト）：0=通常
- 顧客番号（20バイト）
- 振込区分（1バイト）
- 識別情報（7バイト）
- 預金者名（30バイト）
- 予備（5バイト）

#### トレーラ・レコード（120バイト）
- レコード区分（1バイト）：8
- データ件数（6バイト）
- 合計金額（12バイト）
- 予備（101バイト）

#### エンド・レコード（120バイト）
- レコード区分（1バイト）：9
- 予備（119バイト）

### 5.3 文字コード
- すべて半角文字を使用
- カナ文字は半角カナに変換
- ファイルエンコーディング：Shift_JIS
